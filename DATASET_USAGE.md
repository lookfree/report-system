# 数据集功能使用指南

## 功能概述
数据集功能允许在Word模板中配置动态数据区域，在导出时自动从数据库获取最新数据并填充到文档中。

## 使用步骤

### 1. 打开模板编辑器
访问 http://localhost:8082 并选择一个模板进行编辑。

### 2. 配置数据集
1. 在编辑器工具栏点击 **"配置数据集"** 按钮
2. 在弹出的对话框中进行配置

### 3. 数据集配置选项

#### 基本配置
- **展示内容**: 选择"数据集"
- **数据集名称**: 给数据集起个名字，如"模板列表"
- **数据结构**:
  - 单条：显示单条记录
  - 列表：显示多条记录的表格

#### SQL配置
使用以下测试SQL查询：

##### 示例1: 模板列表（列表类型）
```sql
SELECT id, name, "createdAt"
FROM rs_report_templates
LIMIT 5
```
字段：`id`, `name`, `createdAt`

##### 示例2: 系统信息（单条类型）
```sql
SELECT
  '报表系统' as system_name,
  'v1.0.0' as version,
  NOW() as current_time,
  (SELECT COUNT(*) FROM rs_report_templates) as template_count
```
字段：`system_name`, `version`, `current_time`, `template_count`

##### 示例3: 任务统计（列表类型）
```sql
SELECT
  status,
  COUNT(*) as count
FROM rs_report_tasks
GROUP BY status
```
字段：`status`, `count`

### 4. 配置步骤
1. 输入SQL查询语句
2. 添加要显示的字段（点击"添加字段"按钮）
3. 点击"刷新预览"查看数据
4. 确认无误后点击"确定"

### 5. 占位符
配置完成后，系统会在光标位置插入占位符，格式如：
```
{{dataset:cell_1234567890_abcdefg}}
```

### 6. 导出测试
1. 保存模板
2. 点击"导出Word"按钮
3. 系统会自动：
   - 识别占位符
   - 执行SQL查询获取最新数据
   - 将数据替换到文档中
   - 生成最终的Word文档

## 数据展示格式

### 单条数据
显示为键值对形式：
```
系统名称: 报表系统
版本: v1.0.0
当前时间: 2025-09-15 11:00:00
模板数量: 10
```

### 列表数据
显示为表格形式：

| ID | 名称 | 创建时间 |
|----|------|----------|
| 1  | 模板1 | 2025-09-15 |
| 2  | 模板2 | 2025-09-14 |

## 注意事项
1. SQL查询需要正确的表名和字段名
2. PostgreSQL中某些字段名需要加引号，如 `"createdAt"`
3. 字段名必须与SQL查询的列名一致
4. 建议先在"刷新预览"中测试SQL是否正确

## 故障排除

### 如果预览失败
- 检查SQL语法是否正确
- 确认表名和字段名是否存在
- 查看浏览器控制台的错误信息

### 如果导出失败
- 确认模板已保存
- 检查占位符格式是否正确
- 查看后端日志的错误信息